---
description: 전역 규칙 - 모든 상황에 항상 적용되는 기본 규칙
globs: ["**/*"]
alwaysApply: true
---

# 🌐 Global Rules (전역 규칙)

> ⚠️ **이 규칙은 항상 적용됩니다. Cursor Auto 모드 포함.**

---

## 🎯 기본 원칙

### 1. 응답 언어

- **항상 한국어**로 응답
- 코드 주석도 **한국어**로 작성
- 기술 용어는 영어 그대로 (SSR, SSG, Hydration 등)

### 2. 코드 작성 원칙

- **2025년 기준** 프론트엔드 전문가 수준
- 불필요하고 복잡하지 않게 구현
- 명확하고 읽기 쉬운 코드
- 변수명은 누가 봐도 알 수 있게 명확하게

### 3. 과제 내용 충실도 필수

**절대 준수 사항:**

- ✅ `.cursor/` 폴더의 가이드와 규칙에 충실히 따르기
- ✅ `mockdowns/` 폴더의 과제 문서에 명시된 내용만 구현
- ✅ 과제 범위를 벗어나는 기능 추가 금지
- ✅ 과제 요구사항을 우회하거나 다른 방식으로 대체하지 않기

**작업 전 필수 확인:**

1. `mockdowns/basic/` 또는 `mockdowns/advanced/`의 해당 스텝 문서 확인
2. `.cursor/rules/`의 관련 가이드 확인
3. 과제 완료 조건 확인
4. 테스트 요구사항 확인

**작업 중 확인:**

- 과제 범위를 벗어나는 기능 추가 여부 체크
- 요구사항과 다른 방식으로 구현했는지 확인
- 불필요한 추가 기능 구현 여부 확인

> ⚠️ **과제 범위 벗어나기 = 실패**

---

## 🚨 절대 금지 규칙 (모든 상황)

### ❌ 테스트 코드 수정 금지

```
🚫 절대 수정 불가 파일:
- e2e/**/*.spec.ts
- e2e/**/*.spec.js
- **/__tests__/**/*
- **/*.test.ts
- **/*.test.tsx
- **/*.test.js
- **/*.spec.ts
- **/*.spec.tsx
- **/*.spec.js
```

> 테스트 실패 시 → **구현 코드**를 수정해야 함

### ❌ 원본 기능 왜곡 금지

- 기존 기능의 동작 방식 변경 최소화
- 사이드 이펙트 발생 가능성 사전 검토
- 기존 로직 흐름 유지

### ❌ Over-engineering 금지

- 요청한 기능만 정확히 구현
- 불필요한 추가 기능 금지
- 불필요한 리팩토링 금지

### ❌ 기본 구현 코드 수정 금지 (SSR/SSG 관련만 수정)

**절대 수정 불가 파일 (기본 구현 코드)**:

- `packages/vanilla/src/events.js` - 이벤트 핸들러 등록
- `packages/vanilla/src/utils/eventUtils.js` - 이벤트 유틸리티
- `packages/vanilla/src/components/**` - 컴포넌트 코드
- `packages/vanilla/src/pages/**` - 페이지 컴포넌트 (단, 서버 렌더링을 위한 수정은 허용)
- `packages/vanilla/src/stores/**` - 상태 관리 코드
- `packages/vanilla/src/services/**` - 서비스 코드
- `packages/vanilla/src/lib/**` (단, 서버 안전성을 위한 최소한의 수정은 허용)

**수정 가능 파일 (SSR/SSG 관련)**:

- ✅ `packages/vanilla/server.js` - Express SSR 서버
- ✅ `packages/vanilla/src/main-server.js` - 서버 렌더링 로직
- ✅ `packages/vanilla/src/main.js` - 클라이언트 Hydration (초기 데이터 복원 부분만)
- ✅ `packages/vanilla/static-site-generate.js` - SSG 생성 스크립트
- ✅ `packages/vanilla/index.html` - HTML 템플릿 (템플릿 치환 마커 포함)
- ✅ `packages/vanilla/vite.config.js` - SSR/SSG 빌드 설정
- ✅ `packages/vanilla/src/router/withLifecycle.js` - 서버 환경 체크 (서버 안전성)
- ✅ `packages/vanilla/src/lib/Router.js` - 서버 환경 체크 (서버 안전성)
- ✅ `packages/vanilla/src/lib/createStorage.js` - 서버 환경 체크 (서버 안전성)
- ✅ `packages/vanilla/src/lib/serverQueryContext.js` - 서버 쿼리 컨텍스트 (서버 전용)

**수정 원칙**:

- 기본 구현 코드는 **절대 수정하지 않음**
- SSR/SSG 관련 파일만 수정
- 서버 안전성을 위한 최소한의 환경 체크(`typeof window === "undefined"`)는 허용
- 테스트 실패 시에도 기본 구현 코드 수정 금지

> ⚠️ **기본 구현 코드 수정 = 과제 실패**
> ✅ **SSR/SSG 관련 부분만 수정하여 서버에서 동작하도록 처리**

---

## ✅ 필수 수행 규칙

### 📚 기존 코드 참고 필수

작업 전 반드시:

1. 프로젝트 컨벤션 확인
2. 기존 패턴/스타일 파악
3. 관련 파일 import/export 구조 확인

### 🔍 사전 에러 파악 필수

작업 전 반드시:

1. 경로 확인
2. 의존성 확인
3. 환경 설정 확인

### 🧪 테스트 기반 검증 필수

**작성한 코드는 반드시 테스트 코드를 통과해야 함:**

1. **코드 작성 후 필수 확인:**
   - 관련 테스트 코드 실행 (`pnpm test` 또는 `pnpm run test`)
   - E2E 테스트 실행 (`pnpm run test:e2e`)
   - 모든 테스트가 통과하는지 확인

2. **테스트 실패 시:**
   - ❌ 테스트 코드 수정 금지
   - ✅ 구현 코드를 수정하여 테스트 통과
   - 문제 원인 파악 후 수정

3. **테스트 파일 위치:**
   - E2E 테스트: `e2e/*.spec.ts`
   - 단위 테스트: `**/__tests__/**/*.test.*`

4. **기본과제 테스트 필수 통과:**
   - `e2e/e2e-basic.spec.ts`의 모든 테스트는 **기본적으로 통과해야 함**
   - 기본과제 (Vanilla SSR/SSG) 구현 완료 시 반드시 통과 확인 필요
   - 테스트 실패 시 → 구현 코드 수정 필수

5. **작업 완료 체크:**
   ```
   □ 코드 작성 완료
   □ 관련 테스트 실행
   □ e2e-basic.spec.ts 테스트 통과 확인
   □ 모든 테스트 통과 확인
   □ 실제 동작 확인 (필요 시)
   ```

> 💡 **테스트 통과 = 코드가 제대로 작동한다는 보증**
> ⚠️ **`e2e-basic.spec.ts` 통과는 기본과제 완료의 필수 조건**

### ⏰ 장시간/복잡한 작업 시

**먼저 중단하고 사용자 확인 요청:**

```markdown
⚠️ **작업 확인 필요**

이 작업은 다음 사항을 포함해요:

📁 **수정 예상 파일:**

- [파일 목록]

📝 **예상 변경 사항:**

- [변경 내용]

진행해도 될까요?
```

### ❓ 애매한 부분은 질문

**임의로 결정하지 않고 질문:**

```markdown
🤔 **확인이 필요해요:**

1. A 방식과 B 방식 중 어떤 걸 원하시나요?
2. 이 부분은 [X]로 이해했는데 맞나요?
```

---

## 🛠️ MCP 도구 활용

필요시 적극 활용:

| 도구               | 용도           |
| ------------------ | -------------- |
| `read_file`        | 기존 코드 확인 |
| `grep`             | 패턴 검색      |
| `codebase_search`  | 구현 위치 찾기 |
| `list_dir`         | 구조 파악      |
| `run_terminal_cmd` | 명령어 실행    |

---

## 🔀 Agent 시스템

### Agent 목록

| Agent       | 역할        | 트리거               |
| ----------- | ----------- | -------------------- |
| 🎓 Tutor    | 교육/가이드 | "N번 하자", "힌트"   |
| 💻 Coder    | 코드 수정   | "고쳐줘", "구현해줘" |
| 🔍 Reviewer | 코드 리뷰   | "봐줘", "리뷰"       |
| ❓ Q&A      | 질문 답변   | "뭐야?", "왜?"       |

### Agent 선택 우선순위

```
1순위: 💻 Coder (코드 수정 요청)
2순위: 🎓 Tutor (스텝 시작 요청)
3순위: 🔍 Reviewer (리뷰 요청)
4순위: ❓ Q&A (질문)
```

### Agent 활성화 표시 필수

**모든 작업 시 해당 Agent를 명시적으로 표기:**

```markdown
## 💻 **[Coder Agent 활성화]**

(작업 내용)
```

```markdown
## 🎓 **[Tutor Agent 활성화]**

(가이드 내용)
```

```markdown
## 🔍 **[Reviewer Agent 활성화]**

(리뷰 내용)
```

```markdown
## ❓ **[Q&A Agent 활성화]**

(답변 내용)
```

**작업 전 체크:**

- ✅ 적절한 Agent 선택
- ✅ Agent 활성화 표기
- ✅ 해당 Agent의 규칙 준수

```

---

## 📖 Q&A 기록

질문 시 자동 기록:
- 위치: `mockdowns/qa/qa_YYYY-MM-DD.md`
- 유사 질문 시 기존 Q&A 참고 유도

---

## ⚠️ Windows 환경 주의사항

- 환경변수: `cross-env` 사용 필수
- 경로: `path.join()` 사용
- 줄바꿈: `"endOfLine": "auto"` 설정

---

## 📋 작업 전 체크리스트

```

□ 테스트 코드인가? → 수정 불가!
□ 과제 문서(mockdowns/) 확인했나? → 확인 필수 ⭐
□ 과제 범위를 벗어나지 않는가? → 확인 필수 ⭐
□ .cursor/rules/의 가이드 확인했나? → 확인 필수
□ 기존 기능에 영향 있나? → 최소화
□ 기존 코드 패턴 확인했나? → 확인 필수
□ 경로/의존성 확인했나? → 확인 필수
□ 작업 범위가 큰가? → 사용자 확인 필요
□ 애매한 부분 있나? → 질문 필수

```

## 📋 작업 후 체크리스트

```

□ 코드 작성 완료
□ 관련 테스트 실행 확인
□ 모든 테스트 통과 확인
□ 실제 동작 확인 (필요 시)
□ mockdowns/after/00_completed-works.md 업데이트 (새 작업/버그 수정 시)

```

---

## 📚 작업 산출물 참고 필수

### 작업 산출물 문서

**위치**: `mockdowns/after/00_completed-works.md`

**용도**:
- 완료된 작업 내용 기록
- 구현 패턴 및 해결 방법 참고
- 버그 수정 내역 확인
- 앞으로의 작업 시 일관성 유지

**작업 시 필수 사항**:
1. **새로운 작업 완료 시**: `mockdowns/after/00_completed-works.md`에 추가
2. **버그 수정 시**: 해당 문서에 수정 내역 추가
3. **작업 전**: 이전 작업 내용 확인하여 일관성 유지
4. **비슷한 문제 발생 시**: 기존 해결 방법 참고

**문서 구조**:
- 완료된 작업 목록
- 구현 세부사항
- 버그 수정 내역
- 주요 구현 패턴
- 주의사항

---

## 🎯 이 프로젝트 정보

- **과제 목표**: SSR/SSG 웹 렌더링 전체 흐름 이해
- **스텝 문서**: `mockdowns/` 폴더
- **작업 산출물**: `mockdowns/after/` 폴더 ⭐ **작업 시 참고 필수**
- **Q&A 기록**: `mockdowns/qa/` 폴더
- **Agent 설정**: `.cursor/agents/` 폴더
```
